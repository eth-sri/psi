// skipped

a := 0, b := 1; // TODO: chars and strings.
bagel := 0, cookie := 1, nothing := 2, state := 3;

def haveCookie(obj) â‡’ obj==cookie;

def dirichlet(Î±: â„[]){ // TODO: add dirichlet distribution
	assert(Î±.length==2&&Î±[0]==1&&Î±[1]==1);
	p := uniform(0,1);
	return [p,1-p];
}

def main(){
	def actionPrior(){
		// return if flip(0.7) { ['a'] } else { ['a'] ~ actionPrior() } // TODO: recursion
		if flip(0.7){ return [a]; }
		if flip(0.7){ return [a,a]; }
		observe(false);
	}
	def chooseAction(goalSatisfied: â„ â†’ ğ”¹, transition: â„Ã—â„[] â†’ â„, state)=>
		infer((){
			action := actionPrior();
			observe(goalSatisfied(transition(state, action)));
			return action;
		});
	outcomeProbs := [dirichlet([1,1]),dirichlet([1,1])];
	def buttonsToOutcomeProbs(buttons: â„[]){ // TODO: mem/random functions
		assert(buttons.length==1||buttons.length==2&&buttons[0]==a);
		if(buttons.length==2){ assert(buttons[1]==a); }
		return outcomeProbs[buttons.length-1];
	}
	def vendingMachine(state,action: â„[])=>
		[bagel,cookie][categorical(buttonsToOutcomeProbs(action))];
	goal := [bagel,cookie][categorical([0.5,0.5])];
	def goalSatisfied(outcome) => outcome == goal;
	chosenAction := sample(chooseAction(goalSatisfied, vendingMachine, state));
	observe(vendingMachine(state,[a,a]) == cookie);
	observe(chosenAction.length==2 && chosenAction[0]==a && chosenAction[1]==a);
	//return (goal==cookie,buttonsToOutcomeProbs([a])[1],buttonsToOutcomeProbs([a,a])[1]);
	//return goal;
	//return (buttonsToOutcomeProbs([a,a])[1]);
	return (buttonsToOutcomeProbs([a])[1],buttonsToOutcomeProbs([a,a])[1]); // expected: -21/200Â·[-1+râ‚â‰¤0]Â·[-1+râ‚‚â‰¤0]Â·[-râ‚â‰¤0]Â·[-râ‚‚â‰¤0]Â·râ‚‚Â²Â·â…Ÿ(-21/400Â·râ‚‚+-273/4000Â·log(21)+-7/12Â·log(100)Â·râ‚+-7/12Â·log(7)Â·râ‚+-7/40Â·log(100)Â·râ‚‚+-7/40Â·log(7)Â·râ‚‚+-7/40Â·râ‚+-8281/12000Â·log(91)+-91/120Â·log(10)+21/400Â·log(21)Â·râ‚+63/4000Â·log(21)Â·râ‚‚+637/1200Â·log(91)Â·râ‚+637/4000Â·log(91)Â·râ‚‚+7/12Â·log(10)Â·râ‚+7/40Â·log(10)Â·râ‚‚+91/120Â·log(100)+91/120Â·log(7)+91/400)+21/200Â·[-1+râ‚â‰¤0]Â·[-1+râ‚‚â‰¤0]Â·[-râ‚â‰¤0]Â·[-râ‚‚â‰¤0]Â·râ‚‚Â²Â·â…Ÿ(-21/400Â·log(21)Â·râ‚+-63/4000Â·log(21)Â·râ‚‚+-637/1200Â·log(91)Â·râ‚+-637/4000Â·log(91)Â·râ‚‚+-7/12Â·log(10)Â·râ‚+-7/40Â·log(10)Â·râ‚‚+21/400Â·râ‚‚+7/12Â·log(100)Â·râ‚+7/12Â·log(7)Â·râ‚+7/40Â·log(100)Â·râ‚‚+7/40Â·log(7)Â·râ‚‚+7/40Â·râ‚)+21/200Â·[-1+râ‚â‰¤0]Â·[-1+râ‚‚â‰¤0]Â·[-râ‚â‰¤0]Â·[-râ‚‚â‰¤0]Â·râ‚‚Â·â…Ÿ(-21/400Â·râ‚‚+-273/4000Â·log(21)+-7/12Â·log(100)Â·râ‚+-7/12Â·log(7)Â·râ‚+-7/40Â·log(100)Â·râ‚‚+-7/40Â·log(7)Â·râ‚‚+-7/40Â·râ‚+-8281/12000Â·log(91)+-91/120Â·log(10)+21/400Â·log(21)Â·râ‚+63/4000Â·log(21)Â·râ‚‚+637/1200Â·log(91)Â·râ‚+637/4000Â·log(91)Â·râ‚‚+7/12Â·log(10)Â·râ‚+7/40Â·log(10)Â·râ‚‚+91/120Â·log(100)+91/120Â·log(7)+91/400)
}
