// skipped

def sampleLinear(){
	(s,b):=(gauss(0,3), gauss(0,3));
	f:=(x)â‡’s*x+b;
	return f;
}

def piecewise(samplePiece:ğŸ™â†’(â„â†’â„)){
	(lower,upper):=(1,5);
	numPieces:=sample(infer((){ r:=geometric(1/2); observe(lower<=r&&r<=upper); return r; }));
	def step(next:(â„•Ã—(â„Ã—â„))â†’(â„â†’â„))(n:â„•,interval:â„Ã—â„):â„â†’â„{
		if n==1{ return samplePiece(); }
		(lower,upper):=interval;
		middle:=uniform(lower,upper);
		fâ‚:=next(n div 2,(lower,middle));
		fâ‚‚:=next((n+1) div 2,(middle,upper));
		return (x)â‡’if x<middle then fâ‚(x) else fâ‚‚(x);
	}
	rec:=(n:â„•,interval:â„Ã—â„)(x:â„){ assert(false); return 0:â„; };
	//rec:=(n:â„•,interval:â„Ã—â„):â„â†’â„{ assert(false); };
	for i in [0..3){ rec=step(rec); }
	return rec(numPieces,(0,6));
}

def main(){
	f:=piecewise(sampleLinear);
	observations:=[(0,0.6),(1,0.7),(2,1.2),(3,3.2),(4,6.8),(5,8.2),(6,8.4)];
	// for (x,y) in observations { }
	//for i in [0..observations.length){
	for i in [0..7){
		(x,y):=observations[i];
		cobserve(f(x)+gauss(0,0.5),y);
	}
	return f(7);
}
